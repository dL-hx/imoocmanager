# 15.3 é¡µé¢åˆ·æ–°é¢åŒ…å±‘

> è¿™é‡Œä¸»è¦è®²è§£è¯¾ç¨‹å®Œæˆå,æˆ‘å¯¹é¡¹ç›®é”™è¯¯çš„ä¸€äº›ä¿®æ­£

[TOC]

[Githubåœ°å€](https://github.com/lenvo222/imoocmanager/commit/3ba237fa7322a51a63cdf2c090d064c1311fe550)

åœ¨ä¹‹å‰çš„ä»£ç ä¸­, æˆ‘ä»¬åˆ·æ–°é¡µé¢å,é¢åŒ…å±‘ä¼šæ¢å¤ä¸º"é¦–é¡µ",å¦‚ä¸‹å›¾:

![](http://ww1.sinaimg.cn/large/006pJUwqly1g0vjahbcn3g31h00qo0up.gif)

åœ¨æ¼”ç¤ºé¡¹ç›®ä¸­: http://imoocms.51purse.com/

æ˜¯æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„

![](http://ww1.sinaimg.cn/large/006pJUwqly1g0vj44l70pg31h00qoaog.gif)

é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™æ ·çš„é—®é¢˜å‘¢?



## ä¸€ é—®é¢˜åˆ†æ

> 1. react é¡µé¢åˆ·æ–°å,æ‰€ä¿å­˜çš„stateå€¼å°±ä¼šæƒ…å†µ
>
> 2. ä»è§£å†³é¡µé¢åˆ·æ–°,MenuSelectedKey ä¸å˜çš„ç»éªŒæ¥çœ‹, åœ¨åç»­åˆ·æ–°æ—¶,åœ¨componentWillMonutä¸­,ä½¿ç”¨è·¯ç”±å»è§£å†³, å¦‚ä¸‹å›¾
>
>    ![](http://ww1.sinaimg.cn/large/006pJUwqly1g0vi65s95mj30nx0b5q56.jpg)
>
> åˆ†æå¾—å‡º:
>
> å·¥å…·ä¸€: currentKey
>
> å·¥å…·äºŒ:this. dispatch(switchMenu("å°†æ•°æ®ä¼ å…¥è¿™é‡Œå³å¯æ”¹å˜é¢åŒ…å±‘"));
>
> æ‰€ä»¥,åªè¦å°†æ•°æ®ç­›é€‰å‡ºæ¥,ä¼ å…¥dispatchæ–¹æ³•å³å¯ä¿®æ”¹[é¢åŒ…å±‘]

## äºŒ æ€è·¯åˆ†äº«

1. åˆ¤æ–­é¡µé¢æ˜¯å¦åˆ·æ–°,å®šä¹‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³• ,å¦‚æœé¡µé¢åˆ·æ–°,é‡æ–°ç»™menuNameå€¼

   åˆ©ç”¨:componentDidMount()åˆ¤æ–­

2. åˆ›å»ºä¸€ä¸ªå‡½æ•°A,ç”¨æ¥å¤„ç†è¿™ä»¶äº‹æƒ…

3. å¯¼å…¥menuConfigè¿™ä¸ªæ–‡ä»¶,ä»è¿™é‡Œæ‰¾å‡ºéœ€è¦çš„title,ä¸key ,ä½¿å…¶ä¸currentKeyåŒ¹é…

   > å…·ä½“æ˜¯é€šè¿‡if /switch æ¥åˆ¤æ–­æ¡ä»¶å³å¯

4. åœ¨componentDidMount()ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­,è°ƒç”¨è¯¥å‡½æ•°A

## ä¸‰ å°è¯•ä»£ç 

ä¿®æ”¹menuConfig.jsæºæ–‡ä»¶(å‡å·è¡¨ç¤ºå»æ‰),åæ¥è¯æ˜ä¸å»æ‰ä¹Ÿå¯ä»¥(è¿™é‡Œæˆ‘æ˜¯å»é™¤äº†,ä¸ºäº†é¿å…ä¸€äº›æœªçŸ¥çš„é”™è¯¯)

``` js
// src/config/menuConfig.js
const menuList = [
    {
        title: 'é¦–é¡µ',
        key: '/home'
    },
    {
        title: 'UI',
        key: '/ui',
        children: [
            {
                title: 'æŒ‰é’®',
                key: '/ui/buttons',
            },
            {
                title: 'å¼¹æ¡†',
                key: '/ui/modals',
            },
            {
                title: 'Loading',
                key: '/ui/loadings',
            },
            {
                title: 'é€šçŸ¥æé†’',
                key: '/ui/notification',
            },
            {
                title: 'å…¨å±€Message',
                key: '/ui/messages',
            },
            {
                title: 'Tabé¡µç­¾',
                key: '/ui/tabs',
            },
            {
                title: 'å›¾ç‰‡ç”»å»Š',
                key: '/ui/gallery',
            },
            {
                title: 'è½®æ’­å›¾',
                key: '/ui/carousel',
            }
        ]
    },
    {
        title: 'è¡¨å•',
        key: '/form',
        children: [
            {
                title: 'ç™»å½•',
                key: '/form/login',
            },
            {
                title: 'æ³¨å†Œ',
                key: '/form/reg',
            }
        ]
    },
    {
        title: 'è¡¨æ ¼',
        key: '/table',
        children: [
            {
                title: 'åŸºç¡€è¡¨æ ¼',
                key: '/table/basic',
            },
            {
                title: 'é«˜çº§è¡¨æ ¼',
                key: '/table/high',
            }
        ]
    },
    {
        title: 'å¯Œæ–‡æœ¬',
        key: '/rich'
    },
    {
        title: 'åŸå¸‚ç®¡ç†',
        key: '/city'
    },
    {
        title: 'è®¢å•ç®¡ç†',
        key: '/order',
-        btnList: [
-            {
-               title: 'è®¢å•è¯¦æƒ…',
-                key: 'detail'
-            },
-            {
-                title: 'ç»“æŸè®¢å•',
-                key: 'finish'
-            }
-        ]
    },
    {
        title: 'å‘˜å·¥ç®¡ç†',
        key: '/user'
    },
    {
        title: 'è½¦è¾†åœ°å›¾',
        key: '/bikeMap'
    },
    {
        title: 'å›¾æ ‡',
        key: '/charts',
        children: [
            {
                title: 'æŸ±å½¢å›¾',
                key: '/charts/bar'
            },
            {
                title: 'é¥¼å›¾',
                key: '/charts/pie'
            },
            {
                title: 'æŠ˜çº¿å›¾',
                key: '/charts/line'
            },
        ]
    },
    {
        title: 'æƒé™è®¾ç½®',
        key: '/permission'
    },
];
export default menuList;
```



æ‹·è´menuConfigæ–‡ä»¶,æ‰“å¼€å¦ä¸€ä¸ªç¼–è¾‘å™¨

> å› ä¸ºæˆ‘ä»¬éå†çš„æ˜¯æ•°ç»„
>
> æ•°ç»„: mapæ–¹æ³•,ç±»ä¼¼é€’å½’(ES6å¸¸ç”¨æ–¹æ³•)
>
> åˆ¤æ–­: ifè¯­å¥
>
> ğŸ‘ä¸‹é¢çš„ä»£ç æ— å½¢ä¸­ä½¿ç”¨äº†å·¥å‚æ¨¡å¼,å°†éœ€è¦å€¼è¿›è¡Œäº†å¤„ç†

ä¿®æ”¹åmenuConfig.jså¦‚ä¸‹

``` js
const menuList = [
  {
    title: "é¦–é¡µ",
    key: "/home"
  },
  {
    title: "UI",
    key: "/ui",
    children: [
      {
        title: "æŒ‰é’®",
        key: "/ui/buttons"
      },
      {
        title: "å¼¹æ¡†",
        key: "/ui/modals"
      },
      {
        title: "Loading",
        key: "/ui/loadings"
      },
      {
        title: "é€šçŸ¥æé†’",
        key: "/ui/notification"
      },
      {
        title: "å…¨å±€Message",
        key: "/ui/messages"
      },
      {
        title: "Tabé¡µç­¾",
        key: "/ui/tabs"
      },
      {
        title: "å›¾ç‰‡ç”»å»Š",
        key: "/ui/gallery"
      },
      {
        title: "è½®æ’­å›¾",
        key: "/ui/carousel"
      }
    ]
  },
  {
    title: "è¡¨å•",
    key: "/form",
    children: [
      {
        title: "ç™»å½•",
        key: "/form/login"
      },
      {
        title: "æ³¨å†Œ",
        key: "/form/reg"
      }
    ]
  },
  {
    title: "è¡¨æ ¼",
    key: "/table",
    children: [
      {
        title: "åŸºç¡€è¡¨æ ¼",
        key: "/table/basic"
      },
      {
        title: "é«˜çº§è¡¨æ ¼",
        key: "/table/high"
      }
    ]
  },
  {
    title: "å¯Œæ–‡æœ¬",
    key: "/rich"
  },
  {
    title: "åŸå¸‚ç®¡ç†",
    key: "/city"
  },
  {
    title: "è®¢å•ç®¡ç†",
    key: "/order",
  },
  {
    title: "å‘˜å·¥ç®¡ç†",
    key: "/user"
  },
  {
    title: "è½¦è¾†åœ°å›¾",
    key: "/bikeMap"
  },
  {
    title: "å›¾æ ‡",
    key: "/charts",
    children: [
      {
        title: "æŸ±å½¢å›¾",
        key: "/charts/bar"
      },
      {
        title: "é¥¼å›¾",
        key: "/charts/pie"
      },
      {
        title: "æŠ˜çº¿å›¾",
        key: "/charts/line"
      }
    ]
  },
  {
    title: "æƒé™è®¾ç½®",
    key: "/permission"
  }
];
var copy = function(a, b) {
  return Object.assign(a, b);
};
function f1(data) {
  var obj = [];// åˆ›å»ºæ•°ç»„,å°†éœ€è¦çš„æ•°æ®æ”¾å…¥å…¶ä¸­,ä»£ç æ— å½¢ä¸­ä½¿ç”¨äº†å·¥å‚æ¨¡å¼ğŸ‘,å°†éœ€è¦å€¼è¿›è¡Œäº†å¤„ç†
  data.map(item => {
    if (item.children) {// å¦‚æœæœ‰childrenå±æ€§,å°†å…¶å±•å¼€æ”¾å…¥æ•°ç»„ä¸­
      obj.push(...item.children);
    } else{
      obj.push(item);// æ²¡æœ‰childrenå±æ€§,ç›´æ¥æ”¾å…¥æ•°ç»„ä¸­
    }
  });
  return obj
}
console.log(f1(menuList))

```

å¾—åˆ°ç»“æœå¦‚ä¸‹:

![](http://ww1.sinaimg.cn/large/006pJUwqly1g0viemtnt0j30gf0gjq4c.jpg)



## å›› å®ä¾‹ä»£ç 

å¾—åˆ°å¤„ç†å¥½çš„æ•°æ®å,æˆ‘ä»¬å°±å¼€å§‹æˆ‘ä»¬çš„å®ä¾‹ä»£ç 

åœ¨ [src/components/Header/index.js]ä¸­:

1. ```javascript
   import MenuConfig from "./../../config/menuConfig"; //å¯¼å…¥menuConfigè¿™ä¸ªæ–‡ä»¶
   ```

2. ç”¨æ¥å¤„ç†é¡µé¢åˆ·æ–°å,é¢åŒ…å±‘åˆ·æ–°é”™è¯¯çš„çš„ä»£ç (ç±»ä¼¼äºif else/switch case) è¿™é‡Œä½¿ç”¨äº†forEachå¯¹å…¶ç®€åŒ–(ä¹Ÿå¯ä½¿ç”¨for)

   ```javascript
   // å¤„ç†é¡µé¢åˆ·æ–°çš„ä¿®æ”¹é¢åŒ…å±‘çš„ä»£ç 
   handleMenUpdate = (data) => {
     let currentKey = window.location.hash.replace(/#|\?.*$/g, "");
     const {dispatch} = this.props;
   
     let obj = [];
     data.map(item => {
       if (item.children) {// å¦‚æœæœ‰childrenå±æ€§,å°†å…¶å±•å¼€æ”¾å…¥æ•°ç»„ä¸­
         obj.push(...item.children);
       } else{
         obj.push(item);
       }
     });
     const menuName = obj
     menuName.forEach((item)=>{ //éå†æ•°ç»„, åŒ¹é…(åˆ¤æ–­)itemå¯¹åº”çš„title
       if(currentKey==item.key){
         dispatch(switchMenu(item.title))
       }
     })
   };
   ```

3. ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨è¯¥æ–¹æ³•

```javascript
  /* åˆ¤æ–­é¡µé¢æ˜¯å¦åˆ·æ–°,å®šä¹‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³• ,å¦‚æœé¡µé¢åˆ·æ–°,é‡æ–°ç»™menuNameå€¼*/
  componentDidMount() {
    this.handleMenUpdate(MenuConfig);
  }
```



4. å®Œæ•´å®ä¾‹

   ```javascript
   // src/components/Header/index.js
   ...
   import MenuConfig from "./../../config/menuConfig"; //å¯¼å…¥menuConfigè¿™ä¸ªæ–‡ä»¶
   
   
   class Header extends React.Component {
     //å£°æ˜ stateå˜é‡ åœ¨setStateä¹‹å‰è¦å£°æ˜å˜é‡
     state = {};
   
     componentWillMount() {
   	...
     }
   
     // å¤„ç†é¡µé¢åˆ·æ–°çš„ä¿®æ”¹é¢åŒ…å±‘çš„ä»£ç 
     handleMenUpdate = (data) => {
       let currentKey = window.location.hash.replace(/#|\?.*$/g, "");
       const {dispatch} = this.props;
   
       let obj = [];
       data.map(item => {
         if (item.children) {
           obj.push(...item.children);
         } else{
           obj.push(item);
         }
       });
       const menuName = obj
       menuName.forEach((item)=>{
         if(currentKey==item.key){
           dispatch(switchMenu(item.title))
         }
       })
     };
   
     /* åˆ¤æ–­é¡µé¢æ˜¯å¦åˆ·æ–°,å®šä¹‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³• ,å¦‚æœé¡µé¢åˆ·æ–°,é‡æ–°ç»™menuNameå€¼*/
     componentDidMount() {
       this.handleMenUpdate(MenuConfig);
     }
   
     /*å®šä¹‰å¾—åˆ°APIå¤©æ°”çš„æ–¹æ³•*/
     getWeatherAPIData() {
       ...
     }
   
     showExitConfirm = () => {
      ...
     };
   
     render() {
      ...
     }
   }
   
   //å°†state.menuName ç»‘å®šåˆ° props çš„menuName
   const mapStateToProps = state => {
     console.log(state);
     return {
       menuName: state.menuName,
       userName: state.userName
     };
   };
   export default connect(mapStateToProps)(Header);
   ```

   å®Œæˆå,å¯è§,åˆ·æ–°é¡µé¢,é¢åŒ…å±‘ä¸åœ¨æ”¹å˜

![](http://ww1.sinaimg.cn/large/006pJUwqly1g0vj44l70pg31h00qoaog.gif)