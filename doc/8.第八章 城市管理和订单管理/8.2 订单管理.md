

# 8.2 è®¢å•ç®¡ç†

> è®¢å•ç®¡ç†
>
> [Githubè®¢å•ç®¡ç†](https://github.com/lenvo222/imoocmanager/commit/b60192718f50c60ebcc2b5f0f4a008d251aa72ab)
>
> ![](http://ww1.sinaimg.cn/large/006pJUwqly1fzop46z0f6g31h20oee83.gif)
>
>

---

[TOC]

## ä¸€ åŸºç¡€é¡µé¢

[Github](https://github.com/lenvo222/imoocmanager/commit/745481557bf24e3e44b02b57a0a62f10adefcf07)

![](http://ww1.sinaimg.cn/large/006pJUwqly1fznnk6er9zg31760mskjl.gif)

### 1.1 é¡¶éƒ¨å­ç»„ä»¶:é€‰æ‹©è¡¨å•

``` javascript
//å­ç»„ä»¶ä¸€ï¼šé€‰æ‹©è¡¨å•
class FilterForm extends React.Component {
  render() {


    const {getFieldDecorator} = this.props.form;
    return (
      <Form layout="inline">
        <FormItem label="åŸå¸‚">
          {
            getFieldDecorator('city_id')(
              <Select
                style={{width: 100}}
                placeholder="å…¨éƒ¨"
              >
                <Option value="">å…¨éƒ¨</Option>
                <Option value="1">åŒ—äº¬</Option>
                <Option value="2">å¤©æ´¥</Option>
                <Option value="3">æ·±åœ³</Option>
              </Select>
            )
          }
        </FormItem>

        <FormItem label="è®¢å•æ—¶é—´">
          {
            getFieldDecorator('start_time')(
              <DatePicker
                placeholder="è¯·é€‰æ‹©å¼€å§‹æ—¶é—´"
                showTime
                format="YYYY-MM-DD HH:mm:ss"
              />
            )
          }
        </FormItem>

        <FormItem>
          {
            getFieldDecorator('end_time')(
              <DatePicker
                placeholder="è¯·é€‰æ‹©ç»“æŸæ—¶é—´"
                showTime
                format="YYYY-MM-DD HH:mm:ss"
              />
            )
          }
        </FormItem>


        <FormItem label="è®¢å•çŠ¶æ€">
          {
            getFieldDecorator('order_status')(
              <Select
                style={{width: 150}}
                placeholder="å…¨éƒ¨"
              >
                <Option value="">å…¨éƒ¨</Option>
                <Option value="1">è¿›è¡Œä¸­</Option>
                <Option value="2">è¡Œç¨‹ç»“æŸ</Option>
              </Select>
            )
          }
        </FormItem>

        <FormItem>
          <Button type="primary" style={{margin: '0 20px'}}>æŸ¥è¯¢</Button>
          <Button>é‡ç½®</Button>
        </FormItem>
      </Form>
    );
  }
}

FilterForm = Form.create({})(FilterForm);
```

### 1.2 æ•°æ®æ¥å£

#### 1. è®¢å•æ•°æ®æ¥å£

>  /order/list

``` javascript
{
  "code": 0,
  "msg": "",
  "result": {
    "page|1-9": 1,
    "page_size": 10,
    "total": 85,
    "page_count": 9,
    "item_list|10": [{
      "id|+1": 2959165,
      "order_sn": /T180[0-9]{6}/,
      "bike_sn": "800116090",
      "user_id": 908352,
      "user_name": "@cname",
      "mobile": /1[0-9]{10}/,
      "distance": 2000,
      "total_time": 4000,
      "status|1-2": 1,
      "start_time": "@datetime",
      "end_time": "@datetime",
      "total_fee": 1000,
      "user_pay": 300
    }]
  },
}
```

åŒåŸå¸‚ç®¡ç†ï¼š`è°ƒç”¨this.requestList()`ï¼Œé»˜è®¤è¯·æ±‚æ¥å£æ•°æ®

#### 2. ç»“æŸè®¢å•æ¥å£

> /order/ebike_info

``` javascript
{
  "code": '0',
  "result": {
    "id": 27296,
    "bike_sn": "800116116",
    "battery": 100,
    "start_time": "@datetime",
    "location": "åŒ—äº¬å¸‚æµ·æ·€åŒºå¥¥æ—åŒ¹å…‹å…¬å›­"
  }
}
```

#### 3. ç»“æŸæˆåŠŸæ¥å£

> /order/finish_order

``` javascript
{
  "code": '0',
  "result": 'Ok'
}
```

### 1.3 å®ä¾‹ä»£ç 

#### 1. ç»“æŸè®¢å•æŒ‰é’®

>  ç›‘å¬onClickäº‹ä»¶ï¼Œè°ƒç”¨this.handleConfirm()æ˜¾ç¤ºç¡®è®¤ç»“æŸå¼¹æ¡†

   > ```
   >  >  >  > <Button type="primary" style={{marginLeeft: 10}} onClick={this.handlConfirm}>ç»“æŸè®¢å•</Button>
   >  >    
   >  >      
   >  >     ``` javascript
   >  >        // è®¢å•ç»“æŸç¡®è®¤
   >  >        handleConfirm = () => {
   >  >          let item = this.state.selectedItem;
   >  >          if (!item) {
   >  >            Modal.info({
   >  >              title: 'ä¿¡æ¯',
   >  >              content: 'è¯·å…ˆé€‰æ‹©ä¸€æ¡è®¢å•è¿›è¡Œç»“æŸ'
   >  >            });
   >  >            return;
   >  >          }
   >  >      
   >  >          axios.ajax({
   >  >            url: '/order/ebike_info',
   >  >            data: {
   >  >              params: {
   >  >                orderId: item.id
   >  >              }
   >  >            }
   >  >          }).then((res) => {
   >  >              if (res.code == 0) {
   >  >                this.setState({
   >  >                  orderInfo: res.result,
   >  >                  orderConfirmVisble: true,
   >  >                });
   >  >              }
   >  >            }
   >  >          );
   >  >        };
   >  >      ```
   >  >    ```
   >  >  ```
   >  > ```
   > ```

#### 2. ç¡®è®¤å–æ¶ˆ

>  æ‰“å¼€Modalå¼¹æ¡†ï¼Œæ˜¾ç¤ºè¦å–æ¶ˆçš„è®¢å•ä¿¡æ¯

``` javascript
 <Modal
          title="ç»“æŸè®¢å•"
          visible={this.state.orderConfirmVisble}
          onCancel={() => {
            this.setState({
              orderConfirmVisble: false
            });
          }}
          onOk={this.handleFinishOrder}
          width={600}
        >
          <OpenCityForm {...this.state.orderInfo} />
   </Modal>

...

class OpenCityForm extends React.Component {
  render() {
      return (...)
 }
OpenCityForm = Form.create({})(OpenCityForm);
```

#### 3. ç»“æŸè®¢å•

> onOkäº‹ä»¶è°ƒç”¨this.handleFinishOrder()

``` javascript
  // ç»“æŸè®¢å•
  handleFinishOrder = () => {
    let item = this.state.selectedItem;
    axios.ajax({
      url: '/order/finish_order',
      data: {
        params: {
          orderId: item.id
        }
      }
    }).then((res) => {
      if (res.code == 0) {
        message.success('è®¢å•ç»“æŸæˆåŠŸ');
        this.setState({
          orderConfirmVisble: false
        });
        this.requestList();
      }
    });
  };
```

```javascript
// src/pages/order/index.js
import React from 'react';
import {Card, Table, Form, Modal, Button, message, Input, Icon, Select, DatePicker,} from 'antd';
import axios from './../../axios/index';
import Utils from './../../utils/utils';

const FormItem = Form.Item;
const Option = Select.Option;

export default class Order extends React.Component {
  state = {
    orderInfo:{},
    orderConfirmVisble: false
  };

  params = {
    page: 1
  };

  componentDidMount() {
    this.requestList();
  }

  // é»˜è®¤è¯·æ±‚æˆ‘ä»¬çš„æ¥å£æ•°æ®
  requestList = () => {
    let _this = this;
    axios.ajax({
      url: '/order/list',
      data: {
        params: {
          page: this.params.page
        }
      }
    }).then((res) => {
      let list = res.result.item_list.map((item, index) => {
        item.key = index;
        return item;
      });
      this.setState({
        list: list,
        pagination: Utils.pagination(res, (current) => {
          _this.params.page = current;
          _this.requestList();
        })
      });
    });
  };

  // è®¢å•ç»“æŸç¡®è®¤
  handleConfirm = () => {
    let item = this.state.selectedItem;
    if (!item) {
      Modal.info({
        title: 'ä¿¡æ¯',
        content: 'è¯·å…ˆé€‰æ‹©ä¸€æ¡è®¢å•è¿›è¡Œç»“æŸ'
      });
      return;
    }

    axios.ajax({
      url: '/order/ebike_info',
      data: {
        params: {
          orderId: item.id
        }
      }
    }).then((res) => {
        if (res.code == 0) {
          this.setState({
            orderInfo: res.result,
            orderConfirmVisble: true
          });
        }
      }
    );
  };

  // ç»“æŸè®¢å•
  handleFinishOrder = () => {
    let item = this.state.selectedItem;
    axios.ajax({
      url: '/order/finish_order',
      data: {
        params: {
          orderId: item.id
        }
      }
    }).then((res) => {
      if (res.code == 0) {
        message.success('è®¢å•ç»“æŸæˆåŠŸ');
        this.setState({
          orderConfirmVisble: false
        });
        this.requestList();
      }
    });
  };

  onRowClick = (record, index) => {
    let selectKey = [index];
    this.setState({
      selectedRowKeys: selectKey,
      selectedItem: record
    });
  };

  onSelectChange = (selectedRowKeys, selectedItem) => {
    const record = selectedItem[0];
    this.setState({
      selectedRowKeys: selectedRowKeys,
      selectedItem: record
    });
  };

  render() {
    const selectedRowKeys = this.state.selectedRowKeys;

    const rowSelection = {
      type: 'radio',
      selectedRowKeys,
      onChange: this.onSelectChange
    };


    const columns = [{
      title: 'è®¢å•ç¼–å·',
      dataIndex: 'order_sn'
    }, {
      title: 'è½¦è¾†ç¼–å·',
      dataIndex: 'bike_sn'
    }, {
      title: 'ç”¨æˆ·å',
      dataIndex: 'user_name'
    }, {
      title: 'æ‰‹æœºå·',
      dataIndex: 'mobile'
    }, {
      title: 'é‡Œç¨‹',
      dataIndex: 'distance',
      render(distance) {
        return (distance / 1000) + " " + "km";
      }
    }, {
      title: 'è¡Œç¨‹æ—¶é•¿',
      dataIndex: 'total_time'
    }, {
      title: 'çŠ¶æ€',
      dataIndex: 'status',
      render(status) {
        return status == 1 ? 'è¿›è¡Œä¸­' : 'è¡Œç¨‹ç»“æŸ';
      }
    }, {
      title: 'å¼€å§‹æ—¶é—´',
      dataIndex: 'start_time'
    }, {
      title: 'ç»“æŸæ—¶é—´',
      dataIndex: 'end_time'
    }, {
      title: 'è®¢å•é‡‘é¢',
      dataIndex: 'total_fee'
    }, {
      title: 'å®ä»˜é‡‘é¢',
      dataIndex: 'user_pay'
    }];

    //{...this.state.orderInfo}
    // è¿™ä¸ªç”¨æ³• ç›¸å½“äº ä»state ä¸­å–å‡º orderInfo è¿™ä¸ªå¯¹è±¡, ç„¶åå°†å…¶(this.state.orderInfo)å±•å¼€
    // åœ¨å­ç»„ä»¶ ,ä½¿ç”¨propsè¿›è¡Œè§£æ„


    /*
    * var a = {b:[{id: 27296, bike_sn: "800116116"},{name:"å¼ ä¸‰"}]}
    * console.log(a.b) // => [0:{id: 27296, bike_sn: "800116116"},
    *                         1:{name:"å¼ ä¸‰"}
    *                        ]
    *
    * console.log(...a.b) // {id: 27296, bike_sn: "800116116"}
    *                        {name:"å¼ ä¸‰"}
    */
    return (
      <div>
        <Card>
          <FilterForm/>
        </Card>

        <Card style={{marginTop: 10}}>
          <Button type="primary">è®¢å•è¯¦æƒ…</Button>
          <Button type="primary" style={{marginLeft: 20}} onClick={this.handleConfirm}>ç»“æŸè¯¦æƒ…</Button>
        </Card>

        <div className="content-wrap">
          <Table
            bordered
            columns={columns}
            dataSource={this.state.list}
            pagination={this.state.pagination}

            rowSelection={rowSelection}
            onRow={(record, index) => {
              return {
                onClick: () => {
                  this.onRowClick(record, index);
                }
              };
            }}
          />
        </div>
        <Modal
          title="ç»“æŸè®¢å•"
          visible={this.state.orderConfirmVisble}
          onCancel={() => {
            this.setState({
              orderConfirmVisble: false
            });
          }}
          onOk={this.handleFinishOrder}
          width={600}
        >
          <OpenCityForm {...this.state.orderInfo} />
        </Modal>
      </div>
    );
  }
}

//å­ç»„ä»¶ä¸€ï¼šé€‰æ‹©è¡¨å•
class FilterForm extends React.Component {
  render() {


    const {getFieldDecorator} = this.props.form;
    return (
      <Form layout="inline">
        <FormItem label="åŸå¸‚">
          {
            getFieldDecorator('city_id')(
              <Select
                style={{width: 100}}
                placeholder="å…¨éƒ¨"
              >
                <Option value="">å…¨éƒ¨</Option>
                <Option value="1">åŒ—äº¬</Option>
                <Option value="2">å¤©æ´¥</Option>
                <Option value="3">æ·±åœ³</Option>
              </Select>
            )
          }
        </FormItem>

        <FormItem label="è®¢å•æ—¶é—´">
          {
            getFieldDecorator('start_time')(
              <DatePicker
                placeholder="è¯·é€‰æ‹©å¼€å§‹æ—¶é—´"
                showTime
                format="YYYY-MM-DD HH:mm:ss"
              />
            )
          }
        </FormItem>

        <FormItem>
          {
            getFieldDecorator('end_time')(
              <DatePicker
                placeholder="è¯·é€‰æ‹©ç»“æŸæ—¶é—´"
                showTime
                format="YYYY-MM-DD HH:mm:ss"
              />
            )
          }
        </FormItem>


        <FormItem label="è®¢å•çŠ¶æ€">
          {
            getFieldDecorator('order_status')(
              <Select
                style={{width: 150}}
                placeholder="å…¨éƒ¨"
              >
                <Option value="">å…¨éƒ¨</Option>
                <Option value="1">è¿›è¡Œä¸­</Option>
                <Option value="2">è¡Œç¨‹ç»“æŸ</Option>
              </Select>
            )
          }
        </FormItem>

        <FormItem>
          <Button type="primary" style={{margin: '0 20px'}}>æŸ¥è¯¢</Button>
          <Button>é‡ç½®</Button>
        </FormItem>
      </Form>
    );
  }
}

FilterForm = Form.create({})(FilterForm);


//å­ç»„ä»¶äºŒï¼šå¼€é€šåŸå¸‚

class OpenCityForm extends React.Component {
  render() {
    // console.log(this.props); // => {form: {â€¦}, id: 27296, bike_sn: "800116116", battery: 100, start_time: "1972-07-26 03:08:22",Â â€¦}
    const {bike_sn, battery,start_time,location} = this.props;
    const formItemLayout = {
      labelCol: {
        span: 5
      },
      wrapperCol: {
        span: 19
      }
    };

    return (
      <Form>
        <FormItem label="è½¦è¾†ç¼–å·" {...formItemLayout}>
          {bike_sn}
        </FormItem>
        <FormItem label="å‰©ä½™ç”µé‡" {...formItemLayout}>
          {battery + "%"}
        </FormItem>
        <FormItem label="è¡Œç¨‹å¼€å§‹æ—¶é—´" {...formItemLayout}>
          {start_time}
        </FormItem>
        <FormItem label="å½“å‰ä½ç½®" {...formItemLayout}>
          {location}
        </FormItem>
      </Form>
    );
  }
}

OpenCityForm = Form.create({})(OpenCityForm);
```

## äºŒ è®¢å•è¯¦æƒ…(åŸºç¡€ä¿¡æ¯)

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzogr65suwg31h20oetd5.gif)

### 2.1 è·³è½¬è¯¦æƒ…é¡µ

[Githubåœ°å€](https://github.com/lenvo222/imoocmanager/commit/aafa61fe79b92f2eb13ff10feb0e580b1bb799dc#diff-0ccdcb366737d475dcf6eb45fb79a2eaL40)

 #### 1. è®¢å•è¯¦æƒ…

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzod6zyhcbg31h20qsnh5.gif)

> æŒ‰é’®ç›‘å¬onClickäº‹ä»¶
>
> pages->order->index.jsä¸­ï¼šã€è®¢å•è¯¦æƒ…ã€‘æŒ‰é’®ç›‘å¬onClickäº‹ä»¶ï¼Œè°ƒç”¨this.openOrderDetail()ï¼Œè·³è½¬è·¯ç”±

``` javascript
  // è®¢å•è¯¦æƒ…é¡µ
  openOrderDetail = () => {
    let item = this.state.selectedItem;
    if (!item) {
      Modal.info({
        title: 'ä¿¡æ¯',
        content: 'è¯·å…ˆé€‰æ‹©ä¸€æ¡è®¢å•'
      });
      return;
    }
    // é€šè¿‡window.open è¿›è¡Œè·¯ç”±çš„è·³è½¬
    window.open('/#/common/order/detail/' + item.id,'_blank')
  };
```

å…³é”®:`window.open('/#/common/order/detail/' + item.id,'_blank')`

#### 2. ç¼–å†™å…¬å…±ä»£ç 

>  srcç›®å½•ä¸‹ï¼šæ–°å»ºcommon.jsï¼Œç±»ä¼¼admin.jsç¼–å†™é¡¹ç›®å…¬å…±ç»“æ„ä»£ç ï¼Œè´Ÿè´£è·¯ç”±è¯¦æƒ…é¡µå±•ç¤º

``` javascript
// src/common.js
import React from "react";
import {Row, Col} from "antd";
import Header from "./components/Header";
import './style/common.less';

export default class Common extends React.Component {
  render() {
    return (
      <div>
        <Row className="simple-page">
          <Header menuType="second"/>
        </Row>
        <Row className="content">
          {this.props.children}
        </Row>
      </div>
    );
  }
}
```

é€šè¿‡`menuType`ï¼šæ§åˆ¶æ˜¾ç¤ºheaderç»„ä»¶çš„ä¸åŒæ ·å¼ï¼ˆcomponents->header->index.jsï¼‰

#### 3. å®ä¾‹ä»£ç 

``` javascript
// src/components/Header/index.js
import React from 'react';
/*
Headerç»„ä»¶ åˆ†ä¸¤éƒ¨åˆ†å»ºç«‹ä¸¤è¡ŒRow
ç¬¬ä¸€è¡Œæ˜¯ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯(è¿™é‡Œä»¥åè¦é€šè¿‡å˜é‡ä¼ è¾“è¿›æ¥)
* */
import {Row, Col} from "antd";
import './index.less'
import Util from '../../utils/utils'//å¯¼å…¥å…¬å…±æœºåˆ¶
import axios from "../../axios";//å¼•å…¥axiosç»„ä»¶

export default class Header extends React.Component {
    ...
    render() {
        // å–å‡ºmenuType ç”¨ä½œäºŒçº§å¯¼èˆª(çˆ¶ç»„ä»¶Common.jsä¼ æ¥)
        const menuType = this.props.menuType;
        return (
            <div className="header">
                <Row className="header-top">
                    {
                      menuType?
                        <Col span="6" className="logo">
                          <img src="/assets/logo-ant.svg" alt=""/>
                          <span>IMooc é€šç”¨ç®¡ç†ç³»ç»Ÿ</span>
                        </Col>:''
                    }
                    <Col span={menuType?18:24}>
                        <span>æ¬¢è¿,{this.state.userName}</span>
                        <a href="#">é€€å‡º</a>
                    </Col>
                </Row>
                {
                    menuType?'':<Row className="breadcrumb">
                        <Col span="4" className="breadcrumb-title">
                            é¦–é¡µ
                        </Col>
                        <Col span="20" className="weather">
                            <span className="date">{this.state.sysTime}</span>
                            <span className="weather-img">
                            <img src={this.state.dayPictureUrl} alt=""/>
                        </span>
                            <span className="weather-detail">
                            {this.state.weather}
                                {/*{this.state.date}*/}
                        </span>
                        </Col>
                    </Row>
                }
            </div>
        );
    }
}
```

#### 4. ç›¸å…³CSSæ ·å¼

>  CSSæ ·å¼

``` css
// src/components/Header/index.less
@import "./../../style/default.less";
.header {
  background-color:@colorM ;
  .header-top {
    height: 60px;
    line-height: 60px;
    padding: 0 20px;
    text-align: right;
    .logo{
      line-height: 60px;
      text-align: left;
      font-size: 18px;
      img{
        height: 40px;
        vertical-align: middle;
      }
      span{
        margin-left: 5px;
      }
    };
    a {
      margin-left: 40px;
    }
  }
  .breadcrumb {
    height: 40px;
    line-height: 40px;
    text-align: right;
    padding: 0 20px;
    border-top: 1px solid #f9c700;
    .breadcrumb-title {
      text-align: center;
      font-size: @fontC;
      &:after{
        position: absolute;
        content: '';
        left: 83px;
        top: 39px;
        border-top: 9px solid @colorM;
        border-left: 12px solid transparent;
        border-right: 12px solid transparent;
      }
    }
    .weather {
      text-align: right;
      font-size: 14px;
      .date {
        margin-right: 10px;
        vertical-align: middle;
      }
      .weather-img{
        img{
          height: 15px;
        }
      }
      .weather-detail{
        margin-left: 5px;
        vertical-align: middle;
      }

    }
  }
}

// common é¡µé¢ç®€å•å¤´
.simple-page{
  .header-top{
    background:#1890ff;
    color:@colorM;
  }
}

//å¼•å…¥pages->order->detail.less
```

#### 5. router ç»„ä»¶

> `router.js`ä¸­ï¼šå¼•å…¥Commonç»„ä»¶ï¼Œä½¿ç”¨<Route />çš„renderæ–¹æ³•å®šä¹‰åµŒå¥—è·¯ç”±

``` javascript
<Route path="/common" render={() => {
    return <Common>
        <Route path="/common/order/detail/:orderId" component={Login}/>
            </Common>
	}}
/>
```



### 2.2 è®¢å•è¯¦æƒ…åŸºç¡€ä¿¡æ¯

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzogr65suwg31h20oetd5.gif)

> è·å–è®¢å•è¯¦æƒ…åŸºç¡€ä¿¡æ¯

[Githubåœ°å€](https://github.com/lenvo222/imoocmanager/commit/c9bd024be8c50fabb64dcaf422373fd7472b64e7)

#### 1. è®¢å•è¯¦æƒ…æ•°æ®æ¥å£

> /order/detail

``` js
{
  "code": '0',
  "msg": '',
  "result": {
    "status": 2,
    "order_sn": "T1803244422704080JGJI",
    "bike_sn": "802410001",
    "mode|1-2": 1,
    "start_location": "åŒ—äº¬å¸‚æ˜Œå¹³åŒºå›é¾™è§‚ä¸œå¤§è¡—",
    "end_location": "åŒ—äº¬å¸‚æµ·æ·€åŒºå¥¥æ—åŒ¹å…‹å…¬å›­",
    "city_id": 1,
    "mobile": "13597482075",
    "user_name": "@cname",
    "distance": 10000,
    "bike_gps": "116.398806,40.008637",
    "start_time": 1521865027000,
    "end_time": 1521865251000,
    "total_time": 224,
    "position_list": [{
      "lon": 116.361221,
      "lat": 40.043776
    }, {
      "lon": 116.363736,
      "lat": 40.038086
    }, {
      "lon": 116.364599,
      "lat": 40.036484
    }, {
      "lon": 116.373438,
      "lat": 40.03538
    }, {
      "lon": 116.377966,
      "lat": 40.036263
    }, {
      "lon": 116.379762,
      "lat": 40.03654
    }, {
      "lon": 116.38084,
      "lat": 40.033225
    }, {
      "lon": 116.38084,
      "lat": 40.029413
    }, {
      "lon": 116.381343,
      "lat": 40.021291
    }, {
      "lon": 116.381846,
      "lat": 40.015821
    }, {
      "lon": 116.382637,
      "lat": 40.008084
    }, {
      "lon": 116.398806,
      "lat": 40.008637
    }],
    "area": [{
        "lon": "116.274737",
        "lat": "40.139759",
        "ts": null
      },
      {
        "lon": "116.316562",
        "lat": "40.144943",
        "ts": null
      },
      {
        "lon": "116.351631",
        "lat": "40.129498",
        "ts": null
      },
      {
        "lon": "116.390582",
        "lat": "40.082481",
        "ts": null
      },
      {
        "lon": "116.38742",
        "lat": "40.01065",
        "ts": null
      },
      {
        "lon": "116.414297",
        "lat": "40.01181",
        "ts": null
      },
      {
        "lon": "116.696242",
        "lat": "39.964035",
        "ts": null
      },
      {
        "lon": "116.494498",
        "lat": "39.851306",
        "ts": null
      },
      {
        "lon": "116.238086",
        "lat": "39.848647",
        "ts": null
      },
      {
        "lon": "116.189454",
        "lat": "39.999418",
        "ts": null
      },
      {
        "lon": "116.244646",
        "lat": "39.990574",
        "ts": null
      },
      {
        "lon": "116.281441",
        "lat": "40.008703",
        "ts": null
      },
      {
        "lon": "116.271092",
        "lat": "40.142201",
        "ts": null
      },
      {
        "lon": "116.271092",
        "lat": "40.142201",
        "ts": null
      }
    ],
    "area_list": null,
    "npl_list": [{
      "id": 8265,
      "name": "åŒ—è¾°ä¸–çºªä¸­å¿ƒ-aåº§",
      "city_id": 1,
      "type": 3,
      "status": 0,
      "map_point": "116.39338796444|40.008120315215;116.39494038009002|40.008177258745;116.39496911688|40.006268094213;116.39512457763|40.004256795877;116.39360214742|40.004222412241;116.39357190147|40.005075745782;116.39351397873|40.005836165232;116.39338796444|40.008120315215",
      "map_point_array": ["116.39338796444|40.008120315215", "116.396053|40.008273", "116.396448|40.006338", "116.396915|40.004266", "116.39192|40.004072", "116.391525|40.004984", "116.391381|40.005924", "116.391166|40.007913"],
      "map_status": 1,
      "creator_name": "èµµç¨‹ç¨‹",
      "create_time": 1507863539000
    }]
  }
}
```

#### 2. è·å–urlå‚æ•°orderId

> componentDidMount()ä¸­è·å–urlå‚æ•°orderIdï¼šè°ƒç”¨this.getDetailInfo(orderId)è·å–è®¢å•è¯¦æƒ…æ•°æ®

``` javascript
 componentDidMount() {
    // é€šè¿‡this.props.match.params.     å–è·¯ç”±ä¸­çš„id(router-v4)
    let orderId = this.props.match.params.orderId;
    if (orderId) {
      this.getDetailInfo(orderId);
    }
  }

  getDetailInfo = (orderId) => {
    axios.ajax({
      url: '/order/detail',
      data: {
        params: {
          orderId: orderId
        }
      }
    }).then((res) => {
      if (res.code == 0) {
        this.setState({
          orderInfo: res.result,
        });
      }
    });
  };
```

å…³é”®ï¼š`this.props.match.params. `å‚æ•°ã€€è¯¦æƒ…ï¼š[Reactè·å–urlå‚æ•°â€”this.props.match](https://www.cnblogs.com/wx1993/p/7651349.html)

#### 3. å®ä¾‹ä»£ç 

``` javascript
// src/pages/order/detail.js
import React from 'react';
import {Card} from 'antd';
import axios from './../../axios/index';
import './detail.less';

export default class OrderDetail extends React.Component {

  state = {};

  componentDidMount() {
    // é€šè¿‡this.props.match.params.     å–è·¯ç”±ä¸­çš„id(router-v4)
    let orderId = this.props.match.params.orderId;
    if (orderId) {
      this.getDetailInfo(orderId);
    }
  }

  getDetailInfo = (orderId) => {
    axios.ajax({
      url: '/order/detail',
      data: {
        params: {
          orderId: orderId
        }
      }
    }).then((res) => {
      if (res.code == 0) {
        this.setState({
          orderInfo: res.result,
        });
      }
    });
  };

  render() {
    const info = this.state.orderInfo || {};//å¦‚æœorderInfo ä¸ºç©º,è¿”å› {}
    return (
      <div>
        <Card>
          <div id="OrderDetailMap"></div>
          <div className="detail-items">
            <div className="item-title">åŸºç¡€ä¿¡æ¯</div>
            <ul className="detail-form">
              <li>
                <div className="detail-form-left">ç”¨è½¦æ¨¡å¼</div>
                <div className="detail-form-content">{info.mode == 1 ? 'æœåŠ¡åŒº' : 'åœè½¦ç‚¹'}</div>
              </li>
              <li>
                <div className="detail-form-left">è®¢å•ç¼–å·</div>
                <div className="detail-form-content">{info.order_sn}</div>
              </li>
              <li>
                <div className="detail-form-left">è½¦è¾†ç¼–å·</div>
                <div className="detail-form-content">{info.bike_sn}</div>
              </li>
              <li>
                <div className="detail-form-left">ç”¨æˆ·å§“å</div>
                <div className="detail-form-content">{info.user_name}</div>
              </li>
              <li>
                <div className="detail-form-left">æ‰‹æœºå·ç </div>
                <div className="detail-form-content">{info.mobile}</div>
              </li>
            </ul>
          </div>
          <div className="detail-items">
            <div className="item-title">è¡Œé©¶è½¨è¿¹</div>
            <ul className="detail-form">
              <li>
                <div className="detail-form-left">è¡Œç¨‹èµ·ç‚¹</div>
                <div className="detail-form-content">{info.start_location}</div>
              </li>
              <li>
                <div className="detail-form-left">è¡Œç¨‹ç»ˆç‚¹</div>
                <div className="detail-form-content">{info.end_location}</div>
              </li>
              <li>
                <div className="detail-form-left">è¡Œç¨‹é‡Œç¨‹</div>
                <div className="detail-form-content">{info.distance / 1000}å…¬é‡Œ</div>
              </li>
            </ul>
          </div>
        </Card>
      </div>
    );
  }
}
```

## ä¸‰ è®¢å•è¯¦æƒ…(åœ°å›¾)

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzooqlt40pj31ge0mk1ad.jpg)





> å…·ä½“ä½¿ç”¨æŸ¥çœ‹ç™¾åº¦åœ°å›¾apiç½‘å€:http://lbsyun.baidu.com/index.php?title=jspopular/guide/widget

> åœ°å›¾å®ç°æ­¥éª¤
>
> - åˆ›å»ºak(account key) , åŠ è½½ç™¾åº¦åœ°å›¾sdk
> - åœ°å›¾åˆå§‹åŒ–
> - æ·»åŠ åœ°å›¾æ§ä»¶
> - ç»˜åˆ¶ç”¨æˆ·è¡Œé©¶è·¯çº¿
> - ç»˜åˆ¶æœåŠ¡åŒºåœ°å›¾

### 0. ä»£ç æ ¼å¼

``` javascript
// src/pages/order/detail.js
import React from 'react';
import {Card} from 'antd';
import axios from './../../axios/index';
import './detail.less';

export default class OrderDetail extends React.Component {

  state = {};

  componentDidMount() {...}

  getDetailInfo = (orderId) => {...};

  // åˆå§‹åŒ–åœ°å›¾
  renderMap = (result) => {
    this.map = new window.BMap.Map('orderDetailMap');
    // æ·»åŠ åœ°å›¾æ§ä»¶
    this.addMapControl();
    // è°ƒç”¨è·¯çº¿å›¾ç»˜åˆ¶æ–¹æ³•
    this.drawBikeRoute(result.position_list); 
    // è°ƒç”¨æœåŠ¡åŒºç»˜åˆ¶æ–¹æ³•
    this.drawServiceArea(result.area);
  };

  // æ·»åŠ åœ°å›¾æ§ä»¶
  addMapControl = () => {...};

  // ç»˜åˆ¶ç”¨æˆ·çš„è¡Œé©¶è·¯çº¿
  // éœ€è¦åæ ‡ç‚¹(positionList)åšå‚æ•°
  drawBikeRoute = (positionList) => {...}


  // ç»˜åˆ¶æœåŠ¡åŒº
  drawServiceArea = (positionList) => {...};

  render() {
    const info = this.state.orderInfo || {};//å¦‚æœorderInfo ä¸ºç©º,è¿”å› {}
    return (
      <div>
        ...
      </div>
    );
  }
}
```



### 1. åˆ›å»ºak

> è·å–åˆ°Ak å€¼åå°±å¯ä»¥è°ƒç”¨ç™¾åº¦åœ°å›¾çš„æœåŠ¡äº†ğŸ˜‹

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzok0px3zxj31ex0iwtkn.jpg)

---

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzok0y0p05j31gv0buq4r.jpg)

---

![](http://ww1.sinaimg.cn/large/006pJUwqly1fzok9wv7suj31450kzmz7.jpg)



![](http://ww1.sinaimg.cn/large/006pJUwqly1fzokux7x5lj30up0dqn1c.jpg)

å¼•å…¥æ¨¡å—: å½“æ²¡æœ‰npm åŒ…æ—¶,éœ€è¦ä½¿ç”¨src å¼•å…¥scriptæ ‡ç­¾è¿™æ ·(å¦‚:å¼•å…¥ bootstrap..ç­‰)

>  æ‹·è´srcé“¾æ¥ åˆ°publicç›®å½•ä¸‹

`<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=æ‚¨çš„å¯†é’¥"/>`

> æ³¨: åœ¨å¼•å…¥ç¬¬ä¸‰æ–¹æ¨¡å—æ—¶,å¸¸é‡åˆ°,å˜é‡å®šä¹‰æ‰¾ä¸åˆ°
>
> è¿™æ—¶,ä½¿ç”¨   window. å˜é‡å ,   ä½¿å˜é‡ç»‘å®šåˆ°å…¨å±€å˜é‡å³å¯è§£å†³
>
> react æ˜¯å•é¡µé¢ç¨‹åº

``` html
<!DOCTYPE html>
<html lang="en">
<!--public/index.html-->
  <head>
   ...
    <title>React App</title>
    <!--é€šè¿‡script æ ‡ç­¾å¼•å…¥å¤–éƒ¨æ¨¡å—-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=XmWWWzyDp7KbVdtcGKgDqAc8XKgTxGIG"/>
  </head>
  <body>
   ...
  </body>
</html>

```

### 2. åœ°å›¾åˆå§‹åŒ–

``` javascript
  // åˆå§‹åŒ–åœ°å›¾
  renderMap = ()=>{
    this.map = new window.BMap.Map('orderDetailMap');//new BMap.Map('orderDetailMap',,{enableMapClick:false});åœ°å›¾æ— æ³•ç‚¹å‡»
    this.map.centerAndZoom('åŒ—äº¬',11);
    this.addMapControl();
  };
```

### 3. åœ°å›¾æ§ä»¶

``` javascript
 // æ·»åŠ åœ°å›¾æ§ä»¶
  addMapControl = () => {
    let map = this.map;
    map.addControl(new window.BMap.ScaleControl({anchor:window.BMAP_ANCHOR_TOP_RIGHT}));
    map.addControl(new window.BMap.NavigationControl({anchor:window.BMAP_ANCHOR_TOP_RIGHT}))
  };
```



| **æ§ä»¶**     | **ç±»å**           | **ç®€ä»‹**                                                     |
| ------------ | ------------------ | ------------------------------------------------------------ |
| æŠ½è±¡åŸºç±»     | Control            | æ‰€æœ‰æ§ä»¶å‡ç»§æ‰¿æ­¤ç±»çš„æ–¹æ³•ã€å±æ€§ã€‚é€šè¿‡æ­¤ç±»æ‚¨å¯å®ç°è‡ªå®šä¹‰æ§ä»¶   |
| å¹³ç§»ç¼©æ”¾æ§ä»¶ | NavigationControl  | PCç«¯é»˜è®¤ä½äºåœ°å›¾å·¦ä¸Šæ–¹ï¼Œå®ƒåŒ…å«æ§åˆ¶åœ°å›¾çš„å¹³ç§»å’Œç¼©æ”¾çš„åŠŸèƒ½ã€‚ç§»åŠ¨ç«¯æä¾›ç¼©æ”¾æ§ä»¶ï¼Œé»˜è®¤ä½äºåœ°å›¾å³ä¸‹æ–¹ |
| ç¼©ç•¥åœ°å›¾     | OverviewMapControl | é»˜è®¤ä½äºåœ°å›¾å³ä¸‹æ–¹ï¼Œæ˜¯ä¸€ä¸ªå¯æŠ˜å çš„ç¼©ç•¥åœ°å›¾                   |
| æ¯”ä¾‹å°º       | ScaleControl       | é»˜è®¤ä½äºåœ°å›¾å·¦ä¸‹æ–¹ï¼Œæ˜¾ç¤ºåœ°å›¾çš„æ¯”ä¾‹å…³ç³»                       |
| åœ°å›¾ç±»å‹     | MapTypeControl     | é»˜è®¤ä½äºåœ°å›¾å³ä¸Šæ–¹                                           |
| ç‰ˆæƒ         | CopyrightControl   | é»˜è®¤ä½äºåœ°å›¾å·¦ä¸‹æ–¹                                           |
| å®šä½         | GeolocationControl | é’ˆå¯¹ç§»åŠ¨ç«¯å¼€å‘ï¼Œé»˜è®¤ä½äºåœ°å›¾å·¦ä¸‹æ–¹                           |

æ§åˆ¶æ§ä»¶ä½ç½®

> åˆå§‹åŒ–æ§ä»¶æ—¶ï¼Œå¯æä¾›ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå…¶ä¸­çš„anchorå’Œoffsetå±æ€§å…±åŒæ§åˆ¶æ§ä»¶åœ¨åœ°å›¾ä¸Šçš„ä½ç½®ã€‚ anchorè¡¨ç¤ºæ§ä»¶çš„åœé ä½ç½®ï¼Œå³æ§ä»¶åœé åœ¨åœ°å›¾çš„å“ªä¸ªè§’ã€‚å½“åœ°å›¾å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ§ä»¶ä¼šæ ¹æ®åœé ä½ç½®çš„ä¸åŒæ¥è°ƒæ•´è‡ªå·±çš„ä½ç½®ã€‚

| **anchorå€¼**             | **ä½ç½®è¯´æ˜**               |
| ------------------------ | -------------------------- |
| BMAP_ANCHOR_TOP_LEFT     | è¡¨ç¤ºæ§ä»¶å®šä½äºåœ°å›¾çš„å·¦ä¸Šè§’ |
| BMAP_ANCHOR_TOP_RIGHT    | è¡¨ç¤ºæ§ä»¶å®šä½äºåœ°å›¾çš„å³ä¸Šè§’ |
| BMAP_ANCHOR_BOTTOM_LEFT  | è¡¨ç¤ºæ§ä»¶å®šä½äºåœ°å›¾çš„å·¦ä¸‹è§’ |
| BMAP_ANCHOR_BOTTOM_RIGHT | è¡¨ç¤ºæ§ä»¶å®šä½äºåœ°å›¾çš„å³ä¸‹è§’ |

æ§ä»¶ä½ç½®åç§»

> offset

### 4. è¡Œé©¶è·¯çº¿

> 1. ç»˜åˆ¶ èµ·/ç»ˆ åæ ‡ç‚¹
> 2. å°† èµ·ç‚¹/ç»ˆç‚¹  ç”¨æŠ˜çº¿è¿›è¡Œè¿æ¥

``` javascript
  // ç»˜åˆ¶ç”¨æˆ·çš„è¡Œé©¶è·¯çº¿
  // éœ€è¦åæ ‡ç‚¹(positionList)åšå‚æ•°
  drawBikeRoute = (positionList) => {
    let map = this.map; // é€šè¿‡map æ‹¿åˆ°åœ°å›¾çš„å¯¹è±¡
    let startPoint = '';
    let endPoint = '';
    if (positionList.length > 0) {
      let first = positionList[0]; // ç¬¬ä¸€ä¸ªåæ ‡ç‚¹
      let last = positionList[positionList.length - 1]; // ç¬¬ä¸€ä¸ªåæ ‡ç‚¹
      startPoint = new window.BMap.Point(first.lon, first.lat); // arr.lon ç»åº¦ arr.lat çº¬åº¦

      // åˆ›å»ºèµ·å§‹åæ ‡ç‚¹çš„å›¾æ ‡(Icon),è®¾ç½®Iconå›¾æ ‡çš„å¤§å°(å®½:36,é«˜:42)
      let startIcon = new window.BMap.Icon('/assets/start_point.png', new window.BMap.Size(36, 42), {
        // æ§ä»¶ä¸­å›¾ç‰‡çš„å¤§å°
        imageSize: new window.BMap.Size(36, 42),

        // åœé çš„ä½ç½®
        anchor: new window.BMap.Size(36, 42)
      });


      // åˆ›å»ºæ ‡æ³¨
      // å®šä¹‰Marker å°†å›¾æ ‡æ”¾å…¥é¡µé¢(åæ ‡ç‚¹,å›¾æ ‡)
      let startMarker = new window.BMap.Marker(startPoint, {icon: startIcon});

      // å°†æ ‡æ³¨æ·»åŠ åˆ°åœ°å›¾ä¸­
      this.map.addOverlay(startMarker);


      endPoint = new window.BMap.Point(last.lon, last.lat);

      let endIcon = new window.BMap.Icon('/assets/end_point.png', new window.BMap.Size(36, 42), {
        // æ§ä»¶ä¸­å›¾ç‰‡çš„å¤§å°
        imageSize: new window.BMap.Size(36, 42),

        // åœé çš„ä½ç½®
        anchor: new window.BMap.Size(36, 42)
      });

      let endMarker = new window.BMap.Marker(endPoint, {icon: endIcon});

      this.map.addOverlay(endMarker);

      // è¿æ¥è·¯çº¿å›¾
      let trackPoint = [];
      for (let i = 0; i < positionList.length; i++) {
        // æ¢äº†ä¸ªåç§°,ç”¨point ä»£æ›¿positionList æ˜¾å¾—ç®€æ´
        let point = positionList[i];
        // å°†æ¥å£è¿”å›çš„åæ ‡ç‚¹,è½¬æ¢ä¸ºç™¾åº¦åœ°å›¾api éœ€è¦çš„åæ ‡ç‚¹
        trackPoint.push(new window.BMap.Point(point.lon, point.lat));

        // ç”»æŠ˜çº¿
        // çº¿çš„é¢œè‰²,å®½åº¦,é€æ˜åº¦
        let polyline = new window.BMap.Polyline(trackPoint, {
          strokeColor: '#1869AD',
          strokeWeight: 3,
          strokeOpacity: 1
        });

        this.map.addOverlay(polyline);
      }

      // ç”Ÿæˆåœ°å›¾çš„ä¸­å¿ƒç‚¹
      this.map.centerAndZoom(endPoint, 11);
    }
  };

```



### 5. ç»˜åˆ¶æœåŠ¡åŒº

```javascript
// ç»˜åˆ¶æœåŠ¡åŒº
  drawServiceArea = (positionList) => {
    // è¿æ¥è·¯çº¿å›¾
    let trackPoint = [];
    for (let i = 0; i < positionList.length; i++) {
      // æ¢äº†ä¸ªåç§°,ç”¨point ä»£æ›¿positionList æ˜¾å¾—ç®€æ´
      let point = positionList[i];
      // å°†æ¥å£è¿”å›çš„åæ ‡ç‚¹,è½¬æ¢ä¸ºç™¾åº¦åœ°å›¾api éœ€è¦çš„åæ ‡ç‚¹
      trackPoint.push(new window.BMap.Point(point.lon, point.lat));
    }

    // ç»˜åˆ¶æœåŠ¡åŒº       fillColor å¡«å……é¢œè‰²
    let polygon = new window.BMap.Polygon(trackPoint, {
      strokeColor: '#CE0000',
      strokeWeight: 4,
      strokeOpacity: 1,
      fillColor:'#ff8605',
      fillOpacity:0.4
    });

    this.map.addOverlay(polygon);
  };

```

### 6. å®ä¾‹ä»£ç 

```javascript
// src/pages/order/detail.js
import React from 'react';
import {Card} from 'antd';
import axios from './../../axios/index';
import './detail.less';

export default class OrderDetail extends React.Component {

  state = {};

  componentDidMount() {
    // é€šè¿‡this.props.match.params.     å–è·¯ç”±ä¸­çš„id(router-v4)
    let orderId = this.props.match.params.orderId;
    if (orderId) {
      this.getDetailInfo(orderId);
    }
  }

  getDetailInfo = (orderId) => {
    axios.ajax({
      url: '/order/detail',
      data: {
        params: {
          orderId: orderId
        }
      }
    }).then((res) => {
      if (res.code == 0) {
        this.setState({
          orderInfo: res.result,
        });
        this.renderMap(res.result);
      }
    });
  };

  // åˆå§‹åŒ–åœ°å›¾
  renderMap = (result) => {
    this.map = new window.BMap.Map('orderDetailMap');//new BMap.Map('orderDetailMap',,{enableMapClick:false});åœ°å›¾æ— æ³•ç‚¹å‡»
    // this.map.centerAndZoom('åŒ—äº¬', 11);
    // æ·»åŠ åœ°å›¾æ§ä»¶
    this.addMapControl();
    // è°ƒç”¨è·¯çº¿å›¾ç»˜åˆ¶æ–¹æ³•
    this.drawBikeRoute(result.position_list); // åˆå§‹åŒ–å®Œæˆç»˜åˆ¶è·¯çº¿å›¾

    // è°ƒç”¨æœåŠ¡åŒºç»˜åˆ¶æ–¹æ³•
    this.drawServiceArea(result.area);
  };

  // æ·»åŠ åœ°å›¾æ§ä»¶
  addMapControl = () => {
    let map = this.map;
    map.addControl(new window.BMap.ScaleControl({anchor: window.BMAP_ANCHOR_TOP_RIGHT}));
    map.addControl(new window.BMap.NavigationControl({anchor: window.BMAP_ANCHOR_TOP_RIGHT}));
  };

  // ç»˜åˆ¶ç”¨æˆ·çš„è¡Œé©¶è·¯çº¿
  // éœ€è¦åæ ‡ç‚¹(positionList)åšå‚æ•°
  drawBikeRoute = (positionList) => {
    let map = this.map; // é€šè¿‡map æ‹¿åˆ°åœ°å›¾çš„å¯¹è±¡
    let startPoint = '';
    let endPoint = '';
    if (positionList.length > 0) {
      let first = positionList[0]; // ç¬¬ä¸€ä¸ªåæ ‡ç‚¹
      let last = positionList[positionList.length - 1]; // ç¬¬ä¸€ä¸ªåæ ‡ç‚¹
      startPoint = new window.BMap.Point(first.lon, first.lat); // arr.lon ç»åº¦ arr.lat çº¬åº¦

      // åˆ›å»ºèµ·å§‹åæ ‡ç‚¹çš„å›¾æ ‡(Icon),è®¾ç½®Iconå›¾æ ‡çš„å¤§å°(å®½:36,é«˜:42)
      let startIcon = new window.BMap.Icon('/assets/start_point.png', new window.BMap.Size(36, 42), {
        // æ§ä»¶ä¸­å›¾ç‰‡çš„å¤§å°
        imageSize: new window.BMap.Size(36, 42),

        // åœé çš„ä½ç½®
        anchor: new window.BMap.Size(36, 42)
      });


      // åˆ›å»ºæ ‡æ³¨
      // å®šä¹‰Marker å°†å›¾æ ‡æ”¾å…¥é¡µé¢(åæ ‡ç‚¹,å›¾æ ‡)
      let startMarker = new window.BMap.Marker(startPoint, {icon: startIcon});

      // å°†æ ‡æ³¨æ·»åŠ åˆ°åœ°å›¾ä¸­
      this.map.addOverlay(startMarker);


      endPoint = new window.BMap.Point(last.lon, last.lat);

      let endIcon = new window.BMap.Icon('/assets/end_point.png', new window.BMap.Size(36, 42), {
        // æ§ä»¶ä¸­å›¾ç‰‡çš„å¤§å°
        imageSize: new window.BMap.Size(36, 42),

        // åœé çš„ä½ç½®
        anchor: new window.BMap.Size(36, 42)
      });

      let endMarker = new window.BMap.Marker(endPoint, {icon: endIcon});

      this.map.addOverlay(endMarker);

      // è¿æ¥è·¯çº¿å›¾
      let trackPoint = [];
      for (let i = 0; i < positionList.length; i++) {
        // æ¢äº†ä¸ªåç§°,ç”¨point ä»£æ›¿positionList æ˜¾å¾—ç®€æ´
        let point = positionList[i];
        // å°†æ¥å£è¿”å›çš„åæ ‡ç‚¹,è½¬æ¢ä¸ºç™¾åº¦åœ°å›¾api éœ€è¦çš„åæ ‡ç‚¹
        trackPoint.push(new window.BMap.Point(point.lon, point.lat));

        // ç”»æŠ˜çº¿
        // çº¿çš„é¢œè‰²,å®½åº¦,é€æ˜åº¦
        let polyline = new window.BMap.Polyline(trackPoint, {
          strokeColor: '#1869AD',
          strokeWeight: 3,
          strokeOpacity: 1
        });

        this.map.addOverlay(polyline);
      }

      // ç”Ÿæˆåœ°å›¾çš„ä¸­å¿ƒç‚¹
      this.map.centerAndZoom(endPoint, 11);
    }
  };

  // ç»˜åˆ¶æœåŠ¡åŒº
  drawServiceArea = (positionList) => {
    // è¿æ¥è·¯çº¿å›¾
    let trackPoint = [];
    for (let i = 0; i < positionList.length; i++) {
      // æ¢äº†ä¸ªåç§°,ç”¨point ä»£æ›¿positionList æ˜¾å¾—ç®€æ´
      let point = positionList[i];
      // å°†æ¥å£è¿”å›çš„åæ ‡ç‚¹,è½¬æ¢ä¸ºç™¾åº¦åœ°å›¾api éœ€è¦çš„åæ ‡ç‚¹
      trackPoint.push(new window.BMap.Point(point.lon, point.lat));
    }

    // ç»˜åˆ¶æœåŠ¡åŒº       fillColor å¡«å……é¢œè‰²
    let polygon = new window.BMap.Polygon(trackPoint, {
      strokeColor: '#CE0000',
      strokeWeight: 4,
      strokeOpacity: 1,
      fillColor:'#ff8605',
      fillOpacity:0.4
    });

    this.map.addOverlay(polygon);
  };

  render() {
    const info = this.state.orderInfo || {};//å¦‚æœorderInfo ä¸ºç©º,è¿”å› {}
    return (
      <div>
        <Card>
          <div id="orderDetailMap" className='order-map'></div>
          <div className="detail-items">
            <div className="item-title">åŸºç¡€ä¿¡æ¯</div>
            <ul className="detail-form">
              <li>
                <div className="detail-form-left">ç”¨è½¦æ¨¡å¼</div>
                <div className="detail-form-content">{info.mode == 1 ? 'æœåŠ¡åŒº' : 'åœè½¦ç‚¹'}</div>
              </li>
              <li>
                <div className="detail-form-left">è®¢å•ç¼–å·</div>
                <div className="detail-form-content">{info.order_sn}</div>
              </li>
              <li>
                <div className="detail-form-left">è½¦è¾†ç¼–å·</div>
                <div className="detail-form-content">{info.bike_sn}</div>
              </li>
              <li>
                <div className="detail-form-left">ç”¨æˆ·å§“å</div>
                <div className="detail-form-content">{info.user_name}</div>
              </li>
              <li>
                <div className="detail-form-left">æ‰‹æœºå·ç </div>
                <div className="detail-form-content">{info.mobile}</div>
              </li>
            </ul>
          </div>
          <div className="detail-items">
            <div className="item-title">è¡Œé©¶è½¨è¿¹</div>
            <ul className="detail-form">
              <li>
                <div className="detail-form-left">è¡Œç¨‹èµ·ç‚¹</div>
                <div className="detail-form-content">{info.start_location}</div>
              </li>
              <li>
                <div className="detail-form-left">è¡Œç¨‹ç»ˆç‚¹</div>
                <div className="detail-form-content">{info.end_location}</div>
              </li>
              <li>
                <div className="detail-form-left">è¡Œç¨‹é‡Œç¨‹</div>
                <div className="detail-form-content">{info.distance / 1000}å…¬é‡Œ</div>
              </li>
            </ul>
          </div>
        </Card>
      </div>
    );
  }
}
```
